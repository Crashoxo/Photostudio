var retrytimes=0;function MB_morePage(script,div){nodatamsg="";switch(script){case"newsList":doscript="MB_"+script+"2.php";nomoremsg="沒有更多文章";break;case"hotboard":doscript="MB_hotboard.php";nomoremsg="";break;case"b":doscript="MB_B_2k14.php";nomoremsg="沒有更多文章";nodatamsg='<a href="post1.php'+location.search+'&type=1"><i class="fa fa-pencil"></i>來分享第一篇遊戲心得吧！</a>';break;case"createList":doscript="MB_creation_2k14.php";nomoremsg="沒有更多文章";break;case"homecreation":doscript="MB_homeCreation_2k14.php";nomoremsg="沒有更多文章";break;case"homereplylist":doscript="MB_homeReplyList_2k14.php";nomoremsg="沒有更多留言";break;case"acgpiclist":doscript="MB_acgPicList.php";nomoremsg="已經到底囉！";break;default:return}if(1==MB_loading){return}dopara=MB_para[div];if("END"==dopara){if(undefined==$("#MB_moredata"+div).val()){egg("#MB_moredata"+div).html(nomoremsg)}else{egg("#MB_moredata"+div).val(nomoremsg)}return}else if("NODATA"==dopara){egg("#MB_moredata"+div).html(nomoremsg+nodatamsg)}MB_loading=1;egg.ajax({url:"/ajax/"+doscript,param:dopara,method:"GET",success:function(rdata){var split_data=rdata.split("\x3c!--PARA--\x3e");var morediv="#moreDiv"+div;var divtemp=document.createElement("div");divtemp.innerHTML=split_data[0];egg(morediv).get(0).appendChild(divtemp);MB_para[div]=split_data[1];if("END"==split_data[1]){if(undefined==$("#MB_moredata"+div).val()){egg("#MB_moredata"+div).html(nomoremsg)}else{egg("#MB_moredata"+div).val(nomoremsg)}}else if("NODATA"==split_data[1]){egg("#MB_moredata"+div).html(nomoremsg+nodatamsg)}MB_loading=0;if(""==split_data[0]&&10>retrytimes){retrytimes++;MB_morePage(script,div)}if(typeof MB_newsignore!="undefined"){for(var key in MB_newsignore){egg("#news_"+key).hide()}}var hash=window.location.hash;if(""!=hash&&undefined!=egg(hash).get(0)){if(window.view&&view.divSize>1){var adwhere=egg(view.divIn).find(".item").get(view.flipsnapIn.currentPoint);egg(adwhere).get(0).scrollTop=egg(hash).pos().y-50}}if("b"===script&&typeof BH_AlkasooD==="function"){BH_AlkasooD(jQuery)}if(script=="b"&&jQuery(".ad-native").length){googletag.cmd.push(function(){googletag.display(jQuery(".ad-native").attr("id"))})}}})}function MB_getCSRFToken(){return jQuery.ajax({url:"/ajax/MB_getCSRFToken.php",cache:false})}function MB_forum_bookmark_del(sn){$.ajax({url:"/ajax/MB_forumBookmark_del.php",param:"sn="+sn,method:"GET",success:function(r_fdel_txt){$.lightbox.close();if("FIN"==r_fdel_txt){egg("#fdel"+sn).hide()}else{alert(r_fdel_txt)}}})}function opendownload(aurl,iurl){var config={css:{width:"80%",height:"220px"}};content='<div class="game_box">';content+='<a href="javascript:;" onclick="egg.lightbox.close()"><i class="fa fa-times-circle"></i></a>';content+="<p>";if(""!=aurl){content+='<a href="http://ref.gamer.com.tw/0100041/*http://ref.gamer.com.tw/redir.php?url='+aurl+'" target="_blank"><img src="https://i2.bahamut.com.tw/partner/btn_android.png"></a>'}if(""!=iurl){content+='<a href="http://ref.gamer.com.tw/0100041/*http://ref.gamer.com.tw/redir.php?url='+iurl+'" target="_blank"><img src="https://i2.bahamut.com.tw/partner/btn_ios.png"></a>'}content+="</p>";content+="<span>點擊前往官方下載</span>";content+="</div>";egg.lightbox(content,config)}function MB_newMsgLayout(gsn,onlymember,token){egg.lightbox.close();var content="";content+='<div class="bala_post">';content+='<i class="fa fa-times-circle" onclick="egg.lightbox.close()"></i>';content+='<p class="bala_post_msg"><textarea id="balatxt"></textarea><button onclick="MB_guildAddNewMsg('+gsn+",'"+token+"');\">送出</button></p>";if(1==onlymember){content+='<p class="bala_lock"><label><input type="checkbox" id="locked" checked>限成員閱讀</label></p>'}else{content+='<p class="bala_lock"><label><input type="checkbox" id="locked">限成員閱讀<label></p>'}content+="<ul>";content+='<li><a href="javascript:;" onclick="MB_showUpload(this);" class="now">上傳</a></li>';content+='<li><a href="javascript:;" onclick="MB_showEm(this,'+gsn+');">表情</a></li>';content+='<li><a href="javascript:;" onclick="MB_showTuku(this,1);">小屋圖庫</a></li>';content+="</ul>";content+='<div class="bala_post_main">';content+="</div>";content+="</div>";var hh=document.documentElement.clientHeight||document.body.clientHeight||0;var lightboxHeight=hh*.8;var config={css:{width:"100%",height:lightboxHeight+"px","text-align":"left","z-index":"101",top:"120"}};egg.lightbox(content,config);egg.lightbox.refresh();egg("#egg_mask").css("z-index",100);egg(".bala_post_main").css("height",egg("#egg_box").get(0).clientHeight-170+"px");MB_showUpload("");egg.event.add(egg(".bala_post_main"),"scroll",function(){var sh=this.scrollHeight;var al=this.scrollTop+this.offsetHeight;if(sh-al<this.offsetHeight*2&&Tuku_page!=0){MB_showTuku("")}})}function MB_newReplyLayout(asn,token){egg.lightbox.close();var content="";content+='<div class="bala_post">';content+='<i class="fa fa-times-circle" onclick="egg.lightbox.close()"></i>';content+='<p class="bala_post_msg"><textarea id="balatxt"></textarea><button onclick="MB_newReply('+asn+",'"+token+"');\">送出</button></p>";content+="<ul>";content+='<li><a href="javascript:;" onclick="MB_showUpload(this);" class="now">上傳</a></li>';content+='<li><a href="javascript:;" onclick="MB_showEm(this,'+gsn+');">表情</a></li>';content+='<li><a href="javascript:;" onclick="MB_showTuku(this,1);">小屋圖庫</a></li>';content+="</ul>";content+='<div class="bala_post_main">';content+="</div>";content+="</div>";var lightboxHeight=document.documentElement.clientHeight||document.body.clientHeight||0;lightboxHeight=lightboxHeight*.8;var config={css:{width:"100%",height:lightboxHeight+"px","text-align":"left","z-index":"101",top:"120"}};egg.lightbox(content,config);egg.lightbox.refresh();egg("#egg_mask").css("z-index",100);egg(".bala_post_main").css("height",egg("#egg_box").get(0).clientHeight-170+"px");MB_showUpload("");egg.event.add(egg(".bala_post_main"),"scroll",function(){var sh=this.scrollHeight;var al=this.scrollTop+this.offsetHeight;if(sh-al<this.offsetHeight*2&&Tuku_page!=0){MB_showTuku("")}})}function MB_puttoinput(txt){egg("#balatxt").val(egg("#balatxt").val()+txt);egg("#balatxt").get(0).focus()}function MB_showEm(obj,gsn){Tuku_page=0;if(""!=obj){if(egg(".bala_post").find(".now").get(0)){egg(".bala_post").find(".now").get(0).className=""}egg(obj).get(0).className="now"}if(0==gsn){content+="<p>預設表情符號</p>";for(i=1;i<=43;i++){content+='<a href="javascript:;" onclick="MB_puttoinput(\'[e'+i+']\');" ><img src="https://i2.bahamut.com.tw/editor/emotion/'+i+'.gif"></a>'}egg(".bala_post_main").html(content);return}egg.ajax({url:"/ajax/MB_getguildem.php",param:"sn="+gsn,method:"GET",success:function(rdata){var content="";if("null"!=rdata){content+="<p>自訂表情符號</p>";edata=JSON.parse(rdata);for(var key in edata){content+='<a href="javascript:;" onclick="MB_puttoinput(\'[G'+edata[key].code+']\');" ><img src="https://p2.bahamut.com.tw/B/GUILD/e/'+gsn%10+"/"+edata[key].pic+'"></a>'}}content+="<p>預設表情符號</p>";for(i=1;i<=43;i++){content+='<a href="javascript:;" onclick="MB_puttoinput(\'[e'+i+']\');" ><img src="https://i2.bahamut.com.tw/editor/emotion/'+i+'.gif"></a>'}egg(".bala_post_main").html(content)}})}var Tuku_page=0;function MB_showTuku(obj,page){if(""!=obj){if(egg(".bala_post").find(".now").get(0)){egg(".bala_post").find(".now").get(0).className=""}egg(obj).get(0).className="now"}var nowpage=page||0;if(nowpage==1){Tuku_page=1}else{Tuku_page++}if(1==Tuku_page){egg(".bala_post_main").html("")}egg.ajax({url:"/ajax/MB_gettruthimg.php",param:"p="+Tuku_page,method:"GET",success:function(rdata){if(Tuku_page==0){return}if("null"==rdata){Tuku_page=0;return}tdata=JSON.parse(rdata);for(var key in tdata){var a="";a=document.createElement("a");a.href="javascript:MB_puttoinput('"+tdata[key].code+" ');";a.innerHTML='<img src="'+tdata[key].pic+'">';egg(a).appendTo(egg(".bala_post_main").get(0))}}})}function MB_showUpload(obj){Tuku_page=0;if(""!=obj){if(egg(".bala_post").find(".now").get(0)){egg(".bala_post").find(".now").get(0).className=""}egg(obj).get(0).className="now"}var content='<form style="margin:0px;" id="bhImgForm" method="post" enctype="multipart/form-data" target="hideIframe" action="truthUp.php" onsubmit="return MB_uploadOk();"><div id="uploaddiv"><input type="hidden" name="f" value="mobilebala"><input name="upic1" type="file" accept="image/*"><button type="submit">上傳</button></div><div id="uploadmsg" style="display:none">圖片上傳中，請稍候...</div></form><iframe name="hideIframe" id="hideIframe" width="100" height="100"></iframe>';egg(".bala_post_main").html(content)}function mobilePost(messageId){jQuery.ajax({url:globalConfig.apiRoot+"/v1/post_detail.php",method:"GET",data:{gsn:globalConfig.gsn,messageId:messageId},xhrFields:{withCredentials:true}}).done(function(result){if(result.error){jQuery("#contentlist").html(`<div class="list_more" style="color:black">${result.error.message}</div>`);if(result.error.message=="這是屬於公會的悄悄話。"){jQuery("#contentlist").append(`<input type="button" class="list_more" value="${guildJoinMessageByType()}" onclick="mobileGuildJoinByType()">`)}console.error(`get post error (code: ${result.error.code})`);return}jQuery("#contentlist").html(mobilePostLayout(result.data,false,true));mobileCommentListLegacy(messageId)})}function mobilePostList(){jQuery("#readMore").html('<img src="https://i2.bahamut.com.tw/loading.gif">');jQuery.ajax({url:globalConfig.apiRoot+"/v1/post_list.php",method:"GET",data:{gsn:globalConfig.gsn,last:globalConfig.lastSn},xhrFields:{withCredentials:true}}).done(function(result){if(result.error){jQuery("#readMore").html(`<div class="list_more" style="color:black">${result.error.message}</div>`);if(result.error.message=="這是屬於公會的悄悄話。"){jQuery("#readMore").append(`<input type="button" class="list_more" value="${guildJoinMessageByType()}" onclick="mobileGuildJoinByType()">`)}console.error(`get post list error (code: ${result.error.code})`);return}mobilePostListLayout(result.data.postList);if(result.data.postList.length===0||result.data.lastSn===""){jQuery("#readMore").html('<input type="button" class="list_more" style="color:black" value="沒有更多文章了">');return}globalConfig.lastSn=result.data.lastSn;jQuery("#readMore").html('<input type="button" class="list_more" value="看更多..." onclick="mobilePostList()">')})}function mobilePostListLayout(list){list.forEach(post=>{jQuery("#contentlist").append(mobilePostLayout(post[0]))});initPhotoSwipe(".bala_list")}function mobilePostLayout(post,showSingleBalaLink=true,backListWhenDelete=false){var div=document.createElement("div");div.id="msg-"+post.id;div.className="bala_list";var htmlcontent="";var lowuid=post.publisher.id.toLowerCase();let isPoster=lowuid===egg.cookie.get("MB_BAHAID").toLowerCase();if(globalConfig.perm.delete||isPoster){if(backListWhenDelete){htmlcontent+=`<i class="fa fa-times-circle" onclick="mobilePostDelete(${post.id}, ${post.to.gsn})"></i>`}else{htmlcontent+=`<i class="fa fa-times-circle" onclick="mobilePostDelete(${post.id})"></i>`}}if(post.isTopPost){div.setAttribute("data-top-post","yes");htmlcontent+='<i title="置頂貼文" class="fa fa-thumb-tack" style="color:#09c;float:right;font-size:1.2rem;padding-right:5px;"></i>'}useravatar="https://avatar2.bahamut.com.tw/avataruserpic/"+lowuid.substr(0,1)+"/"+lowuid.substr(1,1)+"/"+lowuid+"/"+lowuid+"_s.png";htmlcontent+='<img src="'+useravatar+'"/><div><span>'+post.publisher.name+"：</span>";if(Number(post.to.privateType)>0){htmlcontent+='<i class="fa fa-lock"></i>'}htmlcontent+='<p class="bala_txt">'+mobileBalaUrlTransform(balaMentionTransform(post.content,post.mentions))+"</p>";attrSrc="data-src";attrClass='class="lazyload" ';post.images.forEach(image=>{htmlcontent+=`<a class="photoswipe-image" href="${image.url}"><img ${attrClass}${attrSrc}="${image.url}"></a>`});if(showSingleBalaLink){htmlcontent+='<a href="./singleBala.php?gsn='+post.to.gsn+"&sn="+post.id+'" target="_blank">留言 (<b>'+post.commentCount+"</b>)</a>"}htmlcontent+="<span>"+post.time+"</span></div>";div.innerHTML=htmlcontent;return div}function mobileNewPostLayout(){egg.lightbox.close();var content="";content+='<div class="bala_post">';content+='<i class="fa fa-times-circle" onclick="egg.lightbox.close()"></i>';content+='<p class="bala_post_msg"><textarea id="balatxt"></textarea><button onclick="mobilePostNew();">送出</button></p>';content+="<ul>";content+='<li><a href="javascript:;" onclick="MB_showUpload(this);" class="now">上傳</a></li>';content+='<li><a href="javascript:;" onclick="MB_showEm(this,'+globalConfig.gsn+');">表情</a></li>';content+='<li><a href="javascript:;" onclick="MB_showTuku(this,1);">小屋圖庫</a></li>';content+="</ul>";content+='<div class="bala_post_main">';content+="</div>";content+="</div>";var hh=document.documentElement.clientHeight||document.body.clientHeight||0;var lightboxHeight=hh*.8;var config={css:{width:"100%",height:lightboxHeight+"px","text-align":"left","z-index":"101",top:"120"}};egg.lightbox(content,config);egg.lightbox.refresh();egg("#egg_mask").css("z-index",100);egg(".bala_post_main").css("height",egg("#egg_box").get(0).clientHeight-170+"px");MB_showUpload("");egg.event.add(egg(".bala_post_main"),"scroll",function(){var sh=this.scrollHeight;var al=this.scrollTop+this.offsetHeight;if(sh-al<this.offsetHeight*2&&Tuku_page!=0){MB_showTuku("")}})}function mobilePostNew(){let content=jQuery("#balatxt").val();if(content.match(/^\s*$/)){alert("不能空白!");return}if(countLimit(document.getElementById("balatxt"),600)){return}let csrf=new Bahamut.Csrf;csrf.setCookie();jQuery.ajax({url:globalConfig.apiRoot+"/v1/post_new.php",method:"POST",headers:csrf.getJqueryHeaders(),data:{gsn:globalConfig.gsn,legacy:1,content:content},xhrFields:{withCredentials:true}}).done(function(result){if(result.error){alert(result.error.message);return}jQuery("#balatxt").val("");egg.lightbox.close();mobilePostNewUpdateLayout(result.data.messageId)})}function mobilePostNewUpdateLayout(messageId){jQuery.ajax({url:globalConfig.apiRoot+"/v1/post_detail.php",method:"GET",data:{gsn:globalConfig.gsn,messageId:messageId},xhrFields:{withCredentials:true}}).done(function(result){if(result.error){alert(result.error.message);return}let lastTopPost=jQuery("#contentlist > [data-top-post]:last");if(lastTopPost.length){lastTopPost.after(mobilePostLayout(result.data))}else{jQuery("#contentlist").prepend(mobilePostLayout(result.data))}highlightElement("#msg-"+result.data.id)})}function mobilePostDelete(sn,backgsn=0){if(!confirm("確定要刪除嗎？")){return}var csrf=new Bahamut.Csrf;csrf.setCookie();jQuery.ajax({url:globalConfig.apiRoot+"/v1/post_delete.php",method:"POST",headers:csrf.getJqueryHeaders(),data:{gsn:globalConfig.gsn,messageId:sn},xhrFields:{withCredentials:true}}).done(function(result){if(result.error){alert(result.error.message);return}jQuery("#msg-"+sn).remove();if(backgsn>0){location.href="https://m.gamer.com.tw/guild/guild.php?sn="+backgsn}})}function mobileCommentListLegacy(messageId){jQuery("#readmore").html('<img src="https://i2.bahamut.com.tw/loading.gif">');jQuery.ajax({url:globalConfig.apiRoot+"/v1/comment_list_legacy.php",method:"GET",data:{gsn:globalConfig.gsn,messageId:messageId},xhrFields:{withCredentials:true}}).done(function(result){if(result.error){Dialogify.alert(result.error.message);console.error(`get comment list error (code: ${result.error.code})`);return}let htmlCode=mobileCommentListLayout(messageId,result.data.comments);jQuery(`#commentlist`).prepend(htmlCode);jQuery(`#readmore`).remove();let url=new URL(window.location.href);let cid=parseInt(url.searchParams.get("cid"),10);if(!isNaN(cid)){highlightElement("#reply-"+cid)}initPhotoSwipe(".bala_list")})}function mobileCommentList(messageId,page){jQuery("#readmore").html('<img src="https://i2.bahamut.com.tw/loading.gif">');jQuery.ajax({url:globalConfig.apiRoot+"/v1/comment_list.php",method:"GET",data:{gsn:globalConfig.gsn,messageId:messageId,page:page},xhrFields:{withCredentials:true}}).done(function(result){if(result.error){Dialogify.alert(result.error.message);console.error(`get comment list error (code: ${result.error.code})`);return}let htmlCode=mobileCommentListLayout(messageId,result.data.comments);jQuery(`#commentlist`).prepend(htmlCode);if(result.data.nextPage!==0){jQuery(`#readmore`).html(`<input type="button" class="list_more" value="顯示稍舊的 15 則留言" onclick="mobileCommentList(${messageId},${result.data.nextPage});">`)}else{jQuery(`#readmore`).remove()}})}function mobileCommentListLayout(messageId,comments){let htmlCode="";comments.forEach(comment=>{htmlCode+=mobileCommentLayout(messageId,comment)});return htmlCode}function mobileCommentLayout(messageId,comment){var htmlcontent=`<div id="reply-${comment.id}" class="bala_list bala_child">`;let lowuid=comment.userid.toLowerCase();let isPoster=lowuid===egg.cookie.get("MB_BAHAID").toLowerCase();if(globalConfig.perm.delete||isPoster){htmlcontent+=`<i class="fa fa-times-circle" onclick="mobileCommentDelete(${messageId}, ${comment.id})"></i>`}useravatar="https://avatar2.bahamut.com.tw/avataruserpic/"+lowuid.substr(0,1)+"/"+lowuid.substr(1,1)+"/"+lowuid+"/"+lowuid+"_s.png";htmlcontent+='<img src="'+useravatar+'"/><div><span>'+comment.name+"：</span>";htmlcontent+='<p class="bala_txt">';htmlcontent+=mobileBalaUrlTransform(balaMentionTransform(comment.text,comment.mentions));if(comment.image===undefined){comment.image=comment.images}if(comment.image!==undefined&&comment.image.length!==0){attrSrc="data-src";attrClass='class="lazyload" ';htmlcontent+=`<a class="photoswipe-image" href="${comment.image.B}"><img ${attrClass}${attrSrc}="${comment.image.S}"></a>`}htmlcontent+="</p><span>"+comment.time+"</span></div>";return htmlcontent+"</div>"}function mobileNewCommentLayout(asn){egg.lightbox.close();var content="";content+='<div class="bala_post">';content+='<i class="fa fa-times-circle" onclick="egg.lightbox.close()"></i>';content+='<p class="bala_post_msg"><textarea id="balatxt"></textarea><button onclick="mobileCommentNew('+asn+')">送出</button></p>';content+="<ul>";content+='<li><a href="javascript:;" onclick="MB_showUpload(this);" class="now">上傳</a></li>';content+='<li><a href="javascript:;" onclick="MB_showEm(this,'+globalConfig.gsn+');">表情</a></li>';content+='<li><a href="javascript:;" onclick="MB_showTuku(this,1);">小屋圖庫</a></li>';content+="</ul>";content+='<div class="bala_post_main">';content+="</div>";content+="</div>";var lightboxHeight=document.documentElement.clientHeight||document.body.clientHeight||0;lightboxHeight=lightboxHeight*.8;var config={css:{width:"100%",height:lightboxHeight+"px","text-align":"left","z-index":"101",top:"120"}};egg.lightbox(content,config);egg.lightbox.refresh();egg("#egg_mask").css("z-index",100);egg(".bala_post_main").css("height",egg("#egg_box").get(0).clientHeight-170+"px");MB_showUpload("");egg.event.add(egg(".bala_post_main"),"scroll",function(){var sh=this.scrollHeight;var al=this.scrollTop+this.offsetHeight;if(sh-al<this.offsetHeight*2&&Tuku_page!=0){MB_showTuku("")}})}function mobileCommentNew(messageId){let text=jQuery("#balatxt");let content=text.val();if(content.match(/^\s*$/)){alert("留言不能空白!");return}if(countLimit(document.getElementById("balatxt"),300)){return}let csrf=new Bahamut.Csrf;csrf.setCookie();jQuery.ajax({url:globalConfig.apiRoot+"/v1/comment_new.php",method:"POST",headers:csrf.getJqueryHeaders(),data:{gsn:globalConfig.gsn,messageId:messageId,legacy:1,content:content},xhrFields:{withCredentials:true}}).done(function(result){if(result.error){alert(result.error.message);return}text.val("");let commentData={id:result.data.commentId,time:result.data.time,text:result.data.contxt,mentions:result.data.mention,userid:Cookies.get("BAHAID"),name:Cookies.get("BAHANICK")};jQuery("#commentlist").append(mobileCommentLayout(messageId,commentData));window.scrollTo(0,jQuery(document).height());egg.lightbox.close()})}function mobileCommentDelete(messageId,commentId){if(!confirm("確定要刪除嗎？")){return}var csrf=new Bahamut.Csrf;csrf.setCookie();jQuery.ajax({url:globalConfig.apiRoot+"/v1/comment_delete.php",method:"POST",headers:csrf.getJqueryHeaders(),data:{gsn:globalConfig.gsn,messageId:messageId,commentId:commentId},xhrFields:{withCredentials:true}}).done(function(result){if(result.error){alert(result.error.message);return}jQuery("#reply-"+commentId).hide()})}function mobileBalaUrlTransform(balaText){str=balaText;attrSrc="data-src";attrClass='class="lazyload" ';str=str.replace(/(<[^>]*)h(ttp[s]{0,1}:\/\/[^>]*>)/gi,"$1b$2");str=str.replace(/&amp;(start|t)=/g,"&start=");str=str.replace(/\?(start|t)=/g,"?start=");str=str.replace(/&amp;list/g,"&list");str=str.replace(/&amp;feature/g,"&feature");let youtubeBlock="<iframe "+attrClass+attrSrc+'="bttps://www.youtube.com/embed/$1?autoplay=1&$2" frameborder="0" allowfullscreen></iframe>';str=str.replace(/\[https?:\/\/www\.youtube\.com\/watch\?v=([0-9a-zA-Z_-]{11})((?:&[^=]+=[^&]+)+)?\]\(https?:\/\/www\.youtube\.com\/watch\?v=[0-9a-zA-Z_-]{11}(?:(?:&[^=]+=[^&]+)+)?\)/gi,youtubeBlock);str=str.replace(/\[https?:\/\/youtu\.be\/([0-9a-zA-Z_-]{11})(?:\?(start=[\d]+))?\]\(https?:\/\/youtu\.be\/[0-9a-zA-Z_-]{11}(?:\?(start=[\d]+))?\)/gi,youtubeBlock);str=str.replace(/https?:\/\/www\.youtube\.com\/watch\?v=([0-9a-zA-Z_-]{11})((?:&[^=]+=[^&]+)+)?/gi,youtubeBlock);str=str.replace(/https?:\/\/youtu\.be\/([0-9a-zA-Z_-]{11})(?:\?(start=[\d]+))?/gi,youtubeBlock);str=str.replace(/!\[\]\(h(ttps:\/\/i2\.bahamut\.com\.tw\/editor\/emotion\/[0-9]{1,2}\.gif)\)/gi,function(match,subMatch){return`<img ${attrClass}${attrSrc}="b${subMatch}">`});str=str.replace(/!\[\]\(h(ttps:\/\/p2\.bahamut\.com\.tw\/B\/GUILD\/e\/[0-9]\/[0-9]+_[a-fA-F0-9]{4}\.(?:GIF|JPG|PNG))\)/gi,function(match,subMatch){return`<img ${attrClass}${attrSrc}="b${subMatch}">`});str=str.replace(/!\[\]\(h(ttps?:\/\/.*?\.(?:jpe?g|png|gif))(?:\?w=[0-9]+)?\)/gi,function(match,subMatch){if(subMatch.indexOf("im.bahamut.com.tw")!==-1){subMatch+="?alt=media"}return`<a class="photoswipe-image" href="b${subMatch}"><img ${attrClass}${attrSrc}="b${subMatch}"></a>`});str=str.replace(/\[(.*?)\]\(h(ttps?:\/\/(?:[!#-&(-;=?-Z\^-~]+))\)/gi,'<a href="b$2" target="_blank" style="color: #0055aa;" onclick="urlRedirect(this);">$1</a>');str=str.replace(/h(ttps?:\/\/(?:[!#-&(-;=?-Z\^-~]+))/gi,'<a href="b$1" target="_blank" style="color: #0055aa;" onclick="urlRedirect(this);">b$1</a>');str=str.replace(/a>：\[([0-9a-zA-Z]*):([^\]]*)\]/gi,'a> &gt; <a class="msgname AT1" href="http://home.gamer.com.tw/bahawall.php?owner=$1" target="_blank">$2</a>');str=str.replace(/：\[([0-9a-zA-Z]*):([^\]]*)\]/gi,'、<a class="msgname AT1" href="http://home.gamer.com.tw/bahawall.php?owner=$1" target="_blank">$2</a>');str=str.replace(/\[([0-9a-zA-Z]*):([^\]]*)\]/gi,'<a class="msgname AT1" href="http://home.gamer.com.tw/bahawall.php?owner=$1" target="_blank">$2</a>');str=str.replace(/b(ttp[s]{0,1}:\/\/)/gi,"h$1");str=str.replace(/\n/g,"<br>");return str}function mobileGuildJoinByType(){switch(globalConfig.joinType){case 1:var msgtitle="是否要加入此公會?";var msgconfig={left:"是",onLeft:`ml.guildjoin('${globalConfig.gsn}');`,right:"否",onRight:"egg.lightbox.close()"};break;case 2:var msgtitle="此公會為審核制，是否要申請加入?";var msgconfig={left:"是",onLeft:`egg.lightbox.close();ml.showguildjoin('${globalConfig.gsn}');`,right:"否",onRight:"egg.lightbox.close()"};break;case 3:var msgtitle="此公會僅限邀請加入";var msgconfig={left:"確定",onLeft:"egg.lightbox.close()"};break}ml.showMsg(msgtitle,msgconfig)}function MB_guildReadMore(u){egg.ajax({url:"/ajax/MB_othersMoreMsg.php",param:"u="+u+"&k=8&r="+r+"&t="+t+"&lastGetSn="+lastgetsn,method:"POST",success:MB_showMoreBala})}function MB_showMoreBala(data){var jdata=JSON.parse(data);if(jdata["daysRange"]){r=jdata["daysRange"]}if(jdata["lastTime"]){t=jdata["lastTime"]}if(jdata["err"]){alert(jdata["err"]);return}if(undefined!=egg("#nomsg").get(0)){egg("#nomsg").hide()}if(jdata["msg"]){for(var k in jdata["msg"]){MB_balaLayout(jdata["msg"][k].sn,jdata["msg"][k].userid,jdata["msg"][k].nick,jdata["msg"][k].status,jdata["msg"][k].content,jdata["msg"][k].replynum,jdata["msg"][k].time,false)}}}function MB_balaLayout(sn,userid,nick,status,content,replynum,time,newmsg){var myid=egg.cookie.get("MB_BAHAID").toLowerCase();var div=document.createElement("div");div.id="msg-"+sn;div.className="bala_list";var htmlcontent="";var lowuid=userid.toLowerCase();if(undefined!=egg("#nomsg").get(0)){egg("#nomsg").hide()}if(lowuid==myid){htmlcontent+='<i class="fa fa-times-circle" onclick="MB_delMainMsg('+sn+')"></i>'}useravatar="https://avatar2.bahamut.com.tw/avataruserpic/"+lowuid.substr(0,1)+"/"+lowuid.substr(1,1)+"/"+lowuid+"/"+lowuid+"_s.png";htmlcontent+='<img src="'+useravatar+'"/><div><span>'+nick+"：</span>";if("1"==status){htmlcontent+='<i class="fa fa-lock"></i>'}htmlcontent+='<p class="bala_txt">'+content+'</p><a href="./bala.php?sn='+sn+'" target="_blank">留言 (<b>'+replynum+"</b>)</a><span>"+time+"</span></div>";div.innerHTML=htmlcontent;if(newmsg){var list=egg("#contentlist").get(0);list.insertBefore(div,list.firstChild);window.scrollTo(0,0)}else{egg(div).appendTo(egg("#contentlist").get(0))}Util.ChangeText("msg-"+sn,Util.ChangeText.FLAG_LAZYLOAD)}function MB_balaReplyLayout(asn,sn,userid,nick,comment,date){var myid=egg.cookie.get("MB_BAHAID").toLowerCase();var div=document.createElement("div");div.id="reply-"+sn;div.className="bala_list bala_child";var htmlcontent="";var lowuid=userid.toLowerCase();if(lowuid==myid){htmlcontent+='<i class="fa fa-times-circle" onclick="MB_delReplyMsg('+sn+')"></i>'}useravatar="https://avatar2.bahamut.com.tw/avataruserpic/"+lowuid.substr(0,1)+"/"+lowuid.substr(1,1)+"/"+lowuid+"/"+lowuid+"_s.png";htmlcontent+='<img src="'+useravatar+'"/><div><span>'+nick+"：</span>";htmlcontent+='<p class="bala_txt">'+comment+"</p><span>"+date+"</span></div>";div.innerHTML=htmlcontent;egg(div).appendTo(egg("#contentlist").get(0));Util.ChangeText("reply-"+sn,Util.ChangeText.FLAG_LAZYLOAD)}function MB_guildAddNewMsg(gsn,token){var mainMsg=egg("#balatxt").val();var status=egg("#locked").get(0).checked?1:0;if(""==mainMsg){alert("不能空白！");return}egg.ajax({url:"/ajax/MB_guildNewMsg.php",param:"token="+token+"&msg="+encodeURIComponent(mainMsg)+"&status="+status+"&sf="+gsn,method:"POST",success:function(rjson){var rdata=JSON.parse(rjson);if(rdata.errMsg){alert(rdata.errMsg)}else{MB_balaLayout(rdata.sn,rdata.uid,rdata.nick,rdata.private,rdata.content,0,rdata.date,true)}egg.lightbox.close()}})}function MB_newReply(asn,token){var mainMsg=egg("#balatxt").val();if(""==mainMsg){alert("不能空白！");return}egg.ajax({url:"/ajax/MB_balaNewReply.php",param:"token="+token+"&asn="+asn+"&c="+encodeURIComponent(mainMsg),method:"POST",success:function(rjson){var rdata=JSON.parse(rjson);if(rdata.errMsg){alert(rdata.errMsg)}else{MB_balaReplyLayout(rdata.asn,rdata.sn,rdata.uid,rdata.nick,rdata.comment,rdata.date);window.scrollTo(0,jQuery(document).height())}egg.lightbox.close()}})}function MB_delMainMsg(sn,backgsn){var backgsn=backgsn||0;if(confirm("確定要刪除嗎？")){MB_getCSRFToken().done(function(token){jQuery.ajax({url:"/ajax/MB_delMainMsg.php",method:"POST",data:{sn:sn,ct:token},dataType:"json"}).done(function(text){if("ok"==text.msg){egg("#msg-"+sn).hide();if(0!=backgsn){location.href="http://m.gamer.com.tw/guild/guild.php?sn="+backgsn}}else{alert(text.errMsg)}})})}}function MB_delReplyMsg(sn){if(confirm("確定要刪除嗎？")){$.ajax({url:"/ajax/MB_delReplyMsg.php",method:"POST",param:"sn="+sn,success:function(text){if(""==text){egg("#reply-"+sn).hide()}else{text=JSON.parse(text);alert(text.errMsg)}}})}}function MB_uploadOk(){if(""==egg("[name=upic1]").val()){alert("請選擇圖片");return false}if(2097152<egg("[name=upic1]").get(0).files[0].size){alert("選取的圖片大於2MB無法上傳");return false}egg("#uploadmsg").show();egg("#uploaddiv").hide();return true}function MB_uploadPicSuccess(txt){MB_puttoinput(txt+" ");egg("#uploadmsg").hide();egg("#uploaddiv").show()}function MB_uploadPicError(txt){alert(txt);egg("#uploadmsg").hide();egg("#uploaddiv").show()}function MB_addFavorite(bsn){egg.ajax({url:"/ajax/MB_forumBookmark_add.php",method:"GET",param:"brdsn="+bsn,success:function(code){switch(code){case"nologin":location.href="https://user.gamer.com.tw/login.php";break;case"added":alert("您已訂閱過此板");break;case"success":alert("訂閱看板完成");break;default:alert("系統忙碌中")}MB_B_menu_switch()}})}function showMediaClick(t,area){if("img"==t){document.write('</a><a href="javascript:;" name="openimg"><font color="red" size="3" onclick="forumShowAllMedia();">開啟本頁圖片</font>')}else if("movie"==t){document.write('<font color="red" size="3">請點選觀看影片</font>')}}function attachIMG(o,event){imgid="IMG"+o.id;if(""==o.type){newHTML='<img class="lazyload" data-src="'+o.id+'">'}else{var ww=o.type.match(/width=[0-9]+/i);var hh=o.type.match(/height=[0-9]+/i);width=ww?ww[0].match(/[0-9]+/)[0]:0;height=hh?hh[0].match(/[0-9]+/)[0]:0;newHTML='<img class="lazyload" data-src="'+o.id+'">'}if("click"==event){if(!o.getAttribute("data-expanded")){o.setAttribute("data-expanded","true");o.innerHTML=newHTML}else if(o.id!=o.href){confirmLink(o.href)}else{window.open(o.href,"","")}}else if("show"==event){if(!o.getAttribute("data-expanded")){o.setAttribute("data-expanded","true");o.innerHTML=newHTML}}return false}function confirmLink(link){re=/^https?:\/\/[^\.]+.gamer.com.tw/;if(link.match(re)){window.open(link,"_blank","")}else if(confirm("您即將開啟下列連結，確定嗎?\n\n"+link+"\n\n(巴哈姆特提醒您，不明連結可能包含木馬程式)")){window.open(link,"_blank","")}}function attachMOVIE(o){if("javascript:void(0)"==o.href){return false}osrc=o.href;if(osrc==o.href){osrc=osrc.replace(/https?:\/\/www.youtube.com\/v\//,"https://www.youtube.com/embed/");embedid="embed"+osrc+o.id;var newtube_pattern=/^https?:\/\/www\.youtube\.com\/embed\/([0-9a-zA-Z_-]{11})((?:(?:\&|\?|#|\&#)\w+=\w+)*)/,xuite_pattern=/^https?:\/\/vlog\.xuite\.net\/embed\/([a-zA-Z0-9]{24})((?:(?:\&|\?|#|\&#)\w+=[\w\.]+)*)/,nico_pattern=/^https?:\/\/ext\.nicovideo\.jp\/thumb_watch\/((?:sm|nm|ca|cd|ax|yo|nl|ig|na|cw|za|zb|zc|zd|ze|om|sk|yk|so|am|fz)[0-9]{1,14}|[0-9]{10})\?thumb_mode=html$/,twitch_justin_pattern=/^https?:\/\/(www|player)\.(twitch|justin)\.tv\/.*$/,livehouse_pattern=/^https:\/\/livehouse\.in\/embed\/channel\/(\w+)\/video$/,facebook_pattern=/^https:\/\/www\.facebook\.com\/(\w+)\/videos\/(\d+)\/$/;var matches;if(osrc.match(newtube_pattern)){newHTML=new Util.EmbedPlayer.Youtube(osrc)}else if(osrc.match(xuite_pattern)){newHTML=new Util.EmbedPlayer.Xuite(osrc)}else if(osrc.match(nico_pattern)){newHTML=new Util.EmbedPlayer.Niconico(osrc)}else if(osrc.match(livehouse_pattern)){newHTML=new Util.EmbedPlayer.Livehouse(osrc)}else if(matches=osrc.match(twitch_justin_pattern)){newHTML=new Util.EmbedPlayer.Twitch(osrc)}else if(osrc.match(facebook_pattern)){newHTML=new Util.EmbedPlayer.Facebook(osrc)}o.innerHTML=newHTML;o.href="javascript:void(0)";o.removeAttribute("onclick")}return false}var toastres={};function MB_giveGP(bsn,snB,isLight){MB_getCSRFToken().done(function(token){jQuery.ajax({url:"/ajax/MB_forum_gpbp.php",data:{bsn:bsn,snB:snB,t:1,ct:token},method:"POST"}).done(function(r_txt){if("1__"==r_txt.substr(0,3)){toastr.warning(r_txt.substr(3),"",{tapToDismiss:true});return false}else if(r_txt.substr(0,3)=="2__"){var data=r_txt.substr(3).split(",",2);delGpBp(data[0],data[1]);return}ga("send","event","互動","哈啦區","GP");gpnum="爆"==$("#gp_"+r_txt).html()?"爆":parseInt($("#gp_"+r_txt).html())+1;$("#gp_"+r_txt).html(gpnum);var toastrHtml='勇者獲得了 1 點能量<a href="javascript:delGpBp('+bsn+", "+snB+');" style="float:right;color:yellow;">復原</a>';toastres[bsn+"_"+snB]=toastr.success(toastrHtml,"",{timeOut:1e4})})})}function MB_giveBP(bsn,snB,isLight){MB_getCSRFToken().done(function(token){jQuery.ajax({url:"/ajax/MB_forum_gpbp.php",data:{bsn:bsn,snB:snB,t:2,ct:token},method:"POST"}).done(function(r_txt){if("1__"==r_txt.substr(0,3)){toastr.warning(r_txt.substr(3),"",{tapToDismiss:true});return false}else if(r_txt.substr(0,3)=="2__"){var data=r_txt.substr(3).split(",",2);delGpBp(data[0],data[1]);return}ga("send","event","互動","哈啦區","BP");var toastrHtml='勇者削弱了 1 點精神<a href="javascript:delGpBp('+bsn+", "+snB+');" style="float:right;color:yellow;">復原</a>';toastres[bsn+"_"+snB]=toastr.success(toastrHtml,"",{timeOut:1e4})})})}function delGpBp(bsn,snB){toastr.clear(toastres[bsn+"_"+snB],{force:true});delete toastres[bsn+"_"+snB];MB_getCSRFToken().done(function(token){jQuery.post("/ajax/forum_gpbp_del.php",{bsn:bsn,snB:snB,token:token},function(json){if(json.message){toastr.warning(json.message,"",{tapToDismiss:true});return}if(json.action==1){var elem=jQuery("#gp_"+json.snB);var gpnum="爆"==elem.text()?"爆":parseInt(elem.text(),10)-1;elem.text(gpnum)}toastr.info("您的動作已復原","",{tapToDismiss:true})})})}function FORUM_homeBookmark(area,bsn,sn,atitle,dc1,dc2,dtype,dmachine,dname){if(!User.Login.requireLogin()){return}let aurl;if(area=="G2"){aurl="https://forum.gamer.com.tw/G2.php?bsn="+bsn+"&sn="+sn}else{aurl="https://forum.gamer.com.tw/Co.php?bsn="+bsn+"&sn="+sn}let anopic="";if(jQuery(`#cf${sn} a[name=attachImgName]:first`).attr("id")){anopic=jQuery(`#cf${sn} a[name=attachImgName]:first`).attr("id");if(!anopic.match(/^https?:\/\/truth\.bahamut\.com\.tw\//)){anopic=""}}if(anopic==""){let nopic_tmp=jQuery("#avatar_fpath"+sn).attr("src");anopic=nopic_tmp.replace(/\?x=\d{10}$/g,"");anopic=anopic.replace(/\_s\.png$/g,".png")}let csrf=new Bahamut.Csrf;csrf.setCookie();jQuery.ajax({url:"https://api.gamer.com.tw/home/v1/bookmark_new.php",method:"GET",data:{title:atitle,url:aurl,dcc1:dc1,dcc2:dc2,dctype:dtype,dcmachine:dmachine,gname:dname,nopic:anopic,_t:Date.now()},xhrFields:{withCredentials:true},headers:csrf.getJqueryHeaders()}).done(function(json){if(json.hasOwnProperty("error")){alert(json.error.message)}else{alert("收藏完成！已收入「我的收藏」。")}})}function pdel(sn,bsn,subbsn,page,code,quick_key,snA){var content=egg("#cf"+sn).html();var pattern=/<img .*?src="https?:\/\/truth\.bahamut\.com\.tw\/s01\/[0-9]{6}\/[a-f0-9]{32}\.(?:jpg|jpeg|gif|png)(?:\?[^\?"]*)?"[^>]*?>/i;var patternA=/<a .*?id="https?:\/\/truth\.bahamut\.com\.tw\/s01\/[0-9]{6}\/[a-f0-9]{32}\.(?:jpg|jpeg|gif|png)(?:\?[^\?"]*)?"[^>]*?>/i;var html="<div>確定要刪除嗎？";if(content.match(pattern)||content.match(patternA)){html+='<br /><label><input type="checkbox" id="chkDelTruthImage" value="yes" /> 若文中有我上傳至巴哈的圖片也一併刪除</label>'}html+="</div>";var boxConfig={closeButton:false,className:"popup"};egg.bahabox(html,"訊息",{"取消":function(){egg.lightbox.close()},"確定":function(){var args="bsn="+bsn+"&sn="+sn+"&type=4&code="+code+"&pwd="+quick_key+"&snA="+snA;if(egg("#chkDelTruthImage:checked").size()){args+="&dt=yes"}if(subbsn)args+="&subbsn="+subbsn;if(page)args+="&page="+page;egg.lightbox.close();location.href="delpost2.php?"+args}},boxConfig);egg("#egg_mask").css("height","1500px")}function forumShowAllMedia(area){var area=area||"";if(""!=area){var img=egg("#"+area).find("[name=attachImgName]").get();egg("#"+area).find("[name=openimg]").hide()}else{egg("[name=openimg]").hide();var img=$("[name=attachImgName]").get()}if(img){var imgLength=img.length;for(i=0;i<imgLength;i++){attachIMG(img[i],"show")}}if(""!=area){var movie=egg("#"+area).find("[name=attachMovieName]").get()}else{var movie=$("[name=attachMovieName]").get()}if(movie){var movieLength=movie.length;for(i=0;i<movieLength;i++){attachMOVIE(movie[i])}}return false}function forum_chkLogin(){if(""==egg.cookie.get("MB_BAHAID")||"guest"==egg.cookie.get("MB_BAHAID")){if(confirm("請先登入才能進行此動作")){location.href="https://user.gamer.com.tw/login.php"}return false}return true}function forum_alert(msg,title,callback){if(msg===null||msg===void 0){msg=""}alert(msg);callback&&callback()}function MB_gnn_comment(token){var cont=$("#cont").val();var sn=$("#sn").val();if($("#cont").get(0).disabled){alert("處理中，請稍後!");return false}if(""==cont){alert("請輸入留言內容");return false}if(cont.length>40){alert("限 40 個字喔!");return false}$.ajax({url:"/ajax/MB_gnn_comment_2k14.php",param:"token="+token+"&sn="+sn+"&cont="+encodeURIComponent(cont),method:"POST",success:function(r_txt){if("1__"==r_txt.substr(0,3)){alert(r_txt.substr(3));return false}$("#commendlist").html($("#commendlist").html()+r_txt);$("#cont").val("");egg("#commendlist").get(0).scrollTop=egg("#commendlist").get(0).scrollHeight+1e3;egg("#nocommend").hide()}});return false}function MB_follow(owner){var v=4;MB_getCSRFToken().done(function(token){jQuery.ajax({url:"https://api.gamer.com.tw/ajax/common/home_follow_add.php",method:"POST",data:{who:owner,v:v,token:token},xhrFields:{withCredentials:true}}).done(function(text){alert(text)})})}function MB_creation_contx_reply(sn,rsn,owner,btn,ctoken){var txt=$("#reply"+rsn).val();if(txt.match(/^[ 　\n]+$/)||txt===""){alert("請填留言內容");return}if(btn){btn.disabled=true}$.ajax({url:"/ajax/MB_creation_reply_2k14.php",method:"POST",param:"sn="+sn+"&rsn="+rsn+"&txt="+encodeURIComponent(txt)+"&token="+ctoken,cache:false,success:function(txtdoc){MB_r_creation_contx_reply(txtdoc,owner,rsn,btn)}})}function MB_r_creation_contx_reply(txtdoc,owner,rsn,btn){var replyrs="";switch(txtdoc){case"ERR1":replyrs="系統忙碌，請稍後在試。";break;case"ERR2":replyrs="留言字數過多！";break;case"ERR3":replyrs="文章包含了違反規定的內容";break;case"ERR4":replyrs="請先登入";break;case"ERR5":replyrs="您已被全站禁貼，無法執行此動作";break;case"ERR6":replyrs="您必須通過「手機認證」或勇者等級達 LV3，才能使用這項技能。";break;case"ERR7":replyrs="系統忙碌請稍後在試！";break;case"ERR8":replyrs="只有屋主才能回應！";break;case"ERR9":replyrs="此篇創作連結無效。";break;case"ERR10":replyrs="你無法對 "+owner+" 進行留言喔！";break;case"ERR11":replyrs="此作品限屋主留言！";break;case"ERR12":replyrs="此作品限好友留言";break;case"ERR13":replyrs="沒有這篇留言可以回覆";break;case"ERR14":replyrs="留言失敗，請稍候再試。";break;case"ERR15":replyrs="網頁過期，請重新整後再試。";break;case"ERR16":replyrs="間隔時間太短囉！請稍候再留言。";break}if(btn){btn.disabled=false}if(""!=replyrs){alert(replyrs);return}egg("#reply"+rsn).val("");document.getElementById("reply"+rsn).style.height="32px";jQuery(txtdoc).appendTo(rsn!=0?"#ownerreplys"+rsn:"#replys");var matches=txtdoc.match(/reply_div_([0-9]+)/);if(matches[1]){Util.ChangeText("reply_div_"+matches[1],Util.ChangeText.FLAG_LAZYLOAD)}}function MB_creation_reply_del(sn,rsn,token){if(confirm("確定要刪除這則留言？")){egg.ajax({url:"/ajax/MB_creation_reply_del_2k14.php",method:"POST",param:"sn="+sn+"&rsn="+rsn+"&token="+token,success:function(txtdoc){if(1==txtdoc){egg("#reply_div_"+rsn).hide()}else{alert(txtdoc)}}})}}function getCSRFToken(){return $.ajax({url:"https://api.gamer.com.tw/ajax/home/get_csrf_token.php",cache:false,xhrFields:{withCredentials:true}})}function MB_creation_contx_gp(csn){if(confirm("確定要給予「GP」？")){jQuery.ajax({url:"https://api.gamer.com.tw/ajax/home/get_csrf_token.php",cache:false,xhrFields:{withCredentials:true}}).done(function(token){jQuery.ajax({url:"https://api.gamer.com.tw/ajax/home/creation_gp.php",cache:false,method:"POST",xhrFields:{withCredentials:true},dataType:"json",data:{vcode:token,csn:csn,donation:2}}).done(function(data){if(typeof data.error!="undefined"){alert(data.error.message)}else{jQuery("#creation_gp").text(data.data.gp)}})})}}function MB_loginAlert(){if(confirm("您必須先登入才能進行動作")){location.href="https://user.gamer.com.tw/login.php"}else{return false}}function MB_acgfeaturea(sn,star,token){egg.ajax({url:"/ajax/MB_acgfeaturea.php",param:"s="+sn+"&star="+star+"&token="+token,method:"POST",success:function(rdata){if("評分完成"==rdata){for(i=0;i<=4;i++){if(i+1<=star){egg(".acg_star").find("i:eq("+i+")").get(0).className="fa fa-star"}else{egg(".acg_star").find("i:eq("+i+")").get(0).className="fa fa-star-o"}}}alert(rdata)}})}function MB_creationCommentOnKeyUp(textarea){textarea.style.height=textarea.scrollHeight+2+"px"}function MB_showTopDraw(){if("none"==egg(".top_draw").css("display")){egg(".top_draw").show()}else{egg(".top_draw").hide()}}