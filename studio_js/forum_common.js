(function(window,$){"use strict";var Common={initPhotoSwipe:function(selector){$(selector).on("click",".photoswipe-image",function(e){e.preventDefault();var items=[];var article=$(e.target).parents(selector);var images=article.find(".photoswipe-image, .photoswipe-image-shrink");images.each(function(i,elem){items.push({src:$(elem).attr("href").split("?")[0],w:0,h:0})});var index=0;var targetSrc=e.target.src;for(var i=0;i<items.length;i++){if(targetSrc.split("?")[0]==items[i].src){index=i;break}}pswpOptions.index=index;pswpOptions.bhContainer=article;PSWP=new PhotoSwipe($(".pswp").get(0),PhotoSwipeUI_Default,items,pswpOptions);PSWP.listen("gettingData",function(index,item){if(item.onLoading===undefined&&(item.w<1||item.h<1)){item.onLoading=true;var img=new Image;img.onload=function(){item.w=this.width;item.h=this.height;PSWP.invalidateCurrItems();PSWP.updateSize(true)};img.src=item.src}});PSWP.init()})},expandImage:function(e,elem){e.preventDefault();var imageUrl=$(elem).attr("href");var url=$(elem).data("url");var style=$(elem).data("style");var container=$("<a>").attr("href",url||imageUrl);var image=$("<img>").attr("data-src",imageUrl).addClass("lazyload");if(url){container.attr({target:"_blank",onclick:"Forum.Common.refUrl(this);"})}else{container.addClass("photoswipe-image")}style&&image.attr("style",style);container.append(image);$(elem).replaceWith(container)},expandVideo:function(e,elem){e.preventDefault();var videoUrl=$(elem).attr("href");var videoHtml;var to=Util.EmbedPlayer.TO_WRAPPER_IFRAME;switch($(elem).data("type")){case"video-youtube":videoHtml=new Util.EmbedPlayer.Youtube(videoUrl,to).toString();break;case"video-niconico":videoHtml=new Util.EmbedPlayer.Niconico(videoUrl,to).toString();break;case"video-twitch":case"video-twitchvod":videoHtml=new Util.EmbedPlayer.Twitch(videoUrl,to).toString();break;case"video-xuite":videoHtml=new Util.EmbedPlayer.Xuite(videoUrl,to).toString();break;case"video-livehouse":videoHtml=new Util.EmbedPlayer.Livehouse(videoUrl,to).toString();break;case"video-facebook":videoHtml=new Util.EmbedPlayer.Facebook(videoUrl,to).toString();break;default:}if(videoHtml){$(elem).replaceWith(videoHtml)}},expandAll:function(){$(".loadpic").click()},addDarkThemeSwitch:function(){var switchHtml='<dd>  <a href="javascript:;" class="BH-menu__dark">闇黑模式    <div class="BH-menu__switch-box">      <input id="themeSwitch" class="BH-menu__switch-box__switch-input" type="checkbox">      <label for="themeSwitch" class="BH-menu__switch-box__option">        <span class="BH-menu__switch-box__active-state">ON</span>        <div class="BH-menu__switch-box__icon"></div>        <span class="BH-menu__switch-box__inactive-state">OFF</span>      </label>    </div>  </a></dd>';$(".BH-menu-forumA-right.dropList dl").append(switchHtml);if(Cookies.get("ckForumDarkTheme")=="yes"){$(".BH-menu__switch-box").addClass("is-on");$("#themeSwitch").prop("checked",true)}$(".BH-menu__dark").click(function(e){$(".BH-menu__switch-box").toggleClass("is-on");var checked=$(".BH-menu__switch-box").hasClass("is-on");$("#themeSwitch").prop("checked",checked);if(checked){$("<link>").attr({rel:"stylesheet",type:"text/css",href:"https://i2.bahamut.com.tw/css/forum_dark.css?_=20"}).insertAfter("link:last");Cookies.set("ckForumDarkTheme","yes",{expires:365,domain:"gamer.com.tw"});ga("send","event","其它點擊","哈啦區","套用深色主題")}else{$('link[href*="forum_dark.css"]').remove();Cookies.remove("ckForumDarkTheme",{domain:"gamer.com.tw"});ga("send","event","其它點擊","哈啦區","取消深色主題")}})},refUrl:function(anchor){if(!anchor.href.match(/^https?:\/\/ref\.gamer\.com\.tw/)){anchor.href="https://ref.gamer.com.tw/redir.php?url="+encodeURIComponent(anchor.href)}},utf8Length:function(str){var matches=str.match(/[^\x00-\xff]/gi);return matches===null?str.length:str.length+matches.length*2},bindGifBox:function(tippyPosition,rememberSelect,selectKey,textareaParent){let options={tippyPosition:tippyPosition==undefined?"top":tippyPosition,rememberSelect:rememberSelect==undefined?false:rememberSelect,selectKey:selectKey==undefined?"FORUM_GIF_last_select":selectKey,textareaParent:textareaParent==undefined?".reply-input":textareaParent};new Bahamut.bahaGif(options)},resizeImage:function(resizeTo,maxDpr){$("article img, .cbox_txt img").load(function(){let dprWidth=Math.min(Math.round(window.devicePixelRatio),maxDpr);let img=jQuery(this);if(img.attr("srcset")&&img.attr("srcset").split(",")[1]!=undefined){if(img.width()&&img.width()*dprWidth>resizeTo&&img.parents("table").length==0||img.parents("table").length!=0&&img.width()*dprWidth>=img.parents("td").width()){img.width("100%")}else{img.width(img.width()*dprWidth+"px")}}else if(img.width()&&img.width()>resizeTo||img.parents("table").length!=0&&img.width()>=img.parents("td").width()){img.width("100%")}})}};var PSWP;var pswpOptions={captionEl:false,bgOpacity:.85,showHideOpacity:true,history:false,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">圖片</a>無法載入</div>',shareButtons:[{id:"download",label:"儲存圖片",url:"{{raw_image_url}}",download:true}]};window.Forum=window.Forum||{};window.Forum.Common=Common})(window,jQuery);